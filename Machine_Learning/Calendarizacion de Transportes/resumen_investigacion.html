<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis de Rentabilidad - Flota de Transporte Propia</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }

        .main-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin: 20px auto;
            max-width: 1400px;
            padding: 0;
            overflow: hidden;
        }

        .header-section {
            background: linear-gradient(135deg, var(--primary-color) 0%, #34495e 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .header-section p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content-section {
            padding: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            padding: 25px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-card p {
            font-size: 0.9rem;
            opacity: 0.9;
            margin: 0;
        }

        .section-title {
            color: var(--primary-color);
            border-left: 5px solid var(--secondary-color);
            padding-left: 15px;
            margin: 40px 0 25px 0;
            font-weight: 700;
        }

        .info-box {
            background: #f8f9fa;
            border-left: 4px solid var(--secondary-color);
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid var(--success-color);
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid var(--warning-color);
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
        }

        .filter-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 30px 0;
        }

        .badge-custom {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            margin: 5px;
        }

        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .dataTables_wrapper {
            padding: 20px 0;
        }

        .nav-tabs {
            border-bottom: 2px solid var(--secondary-color);
        }

        .nav-tabs .nav-link {
            color: var(--primary-color);
            font-weight: 600;
            border: none;
            border-bottom: 3px solid transparent;
        }

        .nav-tabs .nav-link.active {
            color: var(--secondary-color);
            background: none;
            border-bottom: 3px solid var(--secondary-color);
        }

        .timeline {
            position: relative;
            padding: 20px 0;
        }

        .timeline-item {
            padding: 20px;
            border-left: 3px solid var(--secondary-color);
            margin-left: 20px;
            margin-bottom: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 8px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--secondary-color);
            margin-left: -11px;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <div class="header-section">
            <h1>üìä An√°lisis de Rentabilidad para Flota de Transporte Propia</h1>
            <p>Evaluaci√≥n de viabilidad econ√≥mica ‚Ä¢ Periodo: Septiembre - Noviembre 2025</p>
        </div>

        <!-- Main Content -->
        <div class="content-section">
            <!-- Navigation Tabs -->
            <ul class="nav nav-tabs" id="mainTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="resumen-tab" data-bs-toggle="tab" data-bs-target="#resumen" type="button">
                        üìã Resumen Ejecutivo
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="datos-tab" data-bs-toggle="tab" data-bs-target="#datos" type="button">
                        üìà An√°lisis de Datos
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="rutas-tab" data-bs-toggle="tab" data-bs-target="#rutas" type="button">
                        üó∫Ô∏è Rutas y Calendario
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="tabla-tab" data-bs-toggle="tab" data-bs-target="#tabla" type="button">
                        üìä Explorador de Datos
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="mainTabsContent">
                <!-- Resumen Ejecutivo Tab -->
                <div class="tab-pane fade show active" id="resumen" role="tabpanel">
                    <h2 class="section-title">Conclusi√≥n Principal</h2>
                    <div class="success-box">
                        <h4>‚úÖ ES VIABLE implementar una flota propia</h4>
                        <p><strong>Enfoque:</strong> Rutas consolidadas desde Santiago</p>
                        <p><strong>Volumen:</strong> ~500 m¬≥/semana que justifica 10 despachos semanales</p>
                        <p><strong>Infraestructura:</strong> 2 rampas de carga de 50m¬≥</p>
                    </div>

                    <!-- Key Metrics -->
                    <h2 class="section-title">M√©tricas Clave del An√°lisis</h2>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <h3>10,327</h3>
                                <p>Env√≠os Analizados</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <h3>$421M</h3>
                                <p>Costo Total (3 meses)</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <h3>64%</h3>
                                <p>Env√≠os desde Santiago</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                <h3>$40,770</h3>
                                <p>Costo Promedio/Env√≠o</p>
                            </div>
                        </div>
                    </div>

                    <!-- Hallazgos Cr√≠ticos -->
                    <h2 class="section-title">Hallazgos Cr√≠ticos por Transportista</h2>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Transportista</th>
                                    <th>Env√≠os</th>
                                    <th>% Total</th>
                                    <th>Costo Total</th>
                                    <th>Costo Promedio</th>
                                    <th>$/kg</th>
                                    <th>Perfil</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="badge bg-primary">PDQ</span></td>
                                    <td>5,365</td>
                                    <td>52%</td>
                                    <td>$130.4M</td>
                                    <td>$24,305</td>
                                    <td>$167</td>
                                    <td><span class="badge bg-warning text-dark">Express/Premium</span></td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-success">SAMEX</span></td>
                                    <td>2,703</td>
                                    <td>26%</td>
                                    <td>$173.0M</td>
                                    <td>$63,989</td>
                                    <td>$193</td>
                                    <td><span class="badge bg-info">Consolidado</span></td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-danger">TVP</span></td>
                                    <td>2,259</td>
                                    <td>22%</td>
                                    <td>$117.7M</td>
                                    <td>$52,089</td>
                                    <td>$5,274*</td>
                                    <td><span class="badge bg-info">Consolidado</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="info-box">
                        <h5>üí° Implicaci√≥n Estrat√©gica</h5>
                        <p><strong>Una flota propia debe competir con el modelo consolidado (SAMEX/TVP)</strong>, NO con el servicio express (PDQ), ya que este √∫ltimo opera en un nicho diferente de alta urgencia.</p>
                    </div>

                    <!-- Principio de Pareto -->
                    <h2 class="section-title">Principio de Pareto - Concentraci√≥n de Operaciones</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="chart-container" style="height: 300px;">
                                <canvas id="paretoChart"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-box">
                                <h5>üìä Concentraci√≥n de Rutas</h5>
                                <ul>
                                    <li><strong>17 rutas</strong> representan el <strong>80% del costo total</strong></li>
                                    <li><strong>14 rutas</strong> representan el <strong>80% de la frecuencia</strong></li>
                                    <li>Alta concentraci√≥n permite <strong>optimizaci√≥n enfocada</strong></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- An√°lisis de Datos Tab -->
                <div class="tab-pane fade" id="datos" role="tabpanel">
                    <h2 class="section-title">Distribuci√≥n de Costos</h2>
                    <div class="chart-container">
                        <canvas id="costosChart"></canvas>
                    </div>

                    <h2 class="section-title">Volumen por D√≠a de la Semana</h2>
                    <div class="chart-container">
                        <canvas id="diasChart"></canvas>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <h2 class="section-title">Top 10 Rutas M√°s Costosas desde Santiago</h2>
                            <div class="chart-container">
                                <canvas id="rutasChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="warning-box">
                        <h5>‚ö†Ô∏è Insight Importante</h5>
                        <p><strong>Mayor actividad:</strong> Martes - Jueves (24.5% - 28.3% del volumen)</p>
                        <p><strong>Propuesta:</strong> Usar viernes para despachos que viajan fin de semana (Iquique, Antofagasta)</p>
                    </div>
                </div>

                <!-- Rutas y Calendario Tab -->
                <div class="tab-pane fade" id="rutas" role="tabpanel">
                    <h2 class="section-title">Calendario de Despachos Optimizado</h2>

                    <div class="info-box">
                        <h5>üì¶ Estrategia de Despacho</h5>
                        <ul>
                            <li><strong>Capacidad por rampa:</strong> 50 m¬≥</li>
                            <li><strong>Rampas disponibles:</strong> 2</li>
                            <li><strong>Horario:</strong> Lunes a Viernes (NO viernes noche)</li>
                            <li><strong>Camiones grandes:</strong> 10 despachos/semana</li>
                            <li><strong>Ocupaci√≥n promedio:</strong> ~98%</li>
                        </ul>
                    </div>

                    <!-- Timeline Semanal -->
                    <div class="timeline">
                        <div class="timeline-item">
                            <h5>üü¢ LUNES</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Ruta</th>
                                        <th>Tipo Cami√≥n</th>
                                        <th>Volumen</th>
                                        <th>Ocupaci√≥n</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Antofagasta + Calama</td>
                                        <td>Grande (50m¬≥)</td>
                                        <td>50 de 75m¬≥</td>
                                        <td><span class="badge bg-warning">67%</span> (25m¬≥ courier)</td>
                                    </tr>
                                    <tr>
                                        <td>Rancagua</td>
                                        <td>Mediano (18m¬≥)</td>
                                        <td>18.3 m¬≥</td>
                                        <td><span class="badge bg-success">100%</span></td>
                                    </tr>
                                    <tr>
                                        <td>Valpara√≠so</td>
                                        <td>Peque√±o (5m¬≥)</td>
                                        <td>4.2 m¬≥</td>
                                        <td><span class="badge bg-success">84%</span></td>
                                    </tr>
                                </tbody>
                            </table>
                            <p class="text-muted">Uso de rampas grandes: 1/2 (50%)</p>
                        </div>

                        <div class="timeline-item">
                            <h5>üü¢ MARTES</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Ruta</th>
                                        <th>Tipo Cami√≥n</th>
                                        <th>Volumen</th>
                                        <th>Ocupaci√≥n</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Osorno + Puerto Montt</td>
                                        <td>Grande (50m¬≥)</td>
                                        <td>49.6 m¬≥</td>
                                        <td><span class="badge bg-success">99% - √ìPTIMO</span></td>
                                    </tr>
                                    <tr>
                                        <td>Talca + Chill√°n</td>
                                        <td>Grande (50m¬≥)</td>
                                        <td>50 de 59m¬≥</td>
                                        <td><span class="badge bg-warning">85%</span> (9m¬≥ courier)</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p class="text-muted">Uso de rampas grandes: 2/2 (100%)</p>
                        </div>

                        <div class="timeline-item">
                            <h5>üü¢ MI√âRCOLES</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Ruta</th>
                                        <th>Tipo Cami√≥n</th>
                                        <th>Volumen</th>
                                        <th>Ocupaci√≥n</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Temuco + Valdivia</td>
                                        <td>Grande (50m¬≥)</td>
                                        <td>50 de 60m¬≥</td>
                                        <td><span class="badge bg-warning">83%</span> (10m¬≥ courier)</td>
                                    </tr>
                                    <tr>
                                        <td>Los Angeles + Concepci√≥n</td>
                                        <td>Grande (50m¬≥)</td>
                                        <td>46.2 m¬≥</td>
                                        <td><span class="badge bg-success">92%</span></td>
                                    </tr>
                                </tbody>
                            </table>
                            <p class="text-muted">Uso de rampas grandes: 2/2 (100%)</p>
                        </div>

                        <div class="timeline-item">
                            <h5>üü¢ JUEVES</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Ruta</th>
                                        <th>Tipo Cami√≥n</th>
                                        <th>Volumen</th>
                                        <th>Ocupaci√≥n</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>La Serena</td>
                                        <td>Grande (50m¬≥)</td>
                                        <td>48.7 m¬≥</td>
                                        <td><span class="badge bg-success">97%</span></td>
                                    </tr>
                                    <tr>
                                        <td>Copiap√≥</td>
                                        <td>Grande (50m¬≥)</td>
                                        <td>41.1 m¬≥</td>
                                        <td><span class="badge bg-info">82%</span></td>
                                    </tr>
                                </tbody>
                            </table>
                            <p class="text-muted">Uso de rampas grandes: 2/2 (100%)</p>
                        </div>

                        <div class="timeline-item">
                            <h5>üü¢ VIERNES (Despachos Fin de Semana)</h5>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Ruta</th>
                                        <th>Tipo Cami√≥n</th>
                                        <th>Volumen</th>
                                        <th>Ocupaci√≥n</th>
                                        <th>Notas</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Iquique</td>
                                        <td>Grande (50m¬≥)</td>
                                        <td>50 de 60m¬≥</td>
                                        <td><span class="badge bg-warning">83%</span></td>
                                        <td>üöö Viaja FDS, entrega LUNES</td>
                                    </tr>
                                    <tr>
                                        <td>Antofagasta Directo</td>
                                        <td>Grande (50m¬≥)</td>
                                        <td>50 de 87m¬≥</td>
                                        <td><span class="badge bg-warning">57%</span></td>
                                        <td>üöö Viaja FDS, entrega LUNES</td>
                                    </tr>
                                </tbody>
                            </table>
                            <p class="text-muted">Uso de rampas grandes: 2/2 (100%)</p>
                        </div>
                    </div>

                    <!-- Resumen Operaci√≥n Semanal -->
                    <h2 class="section-title">Resumen de Operaci√≥n Semanal</h2>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <h3>10</h3>
                                <p>Despachos Camiones Grandes/Semana</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <h3>490 m¬≥</h3>
                                <p>Volumen Transportado/Semana</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                <h3>98%</h3>
                                <p>Ocupaci√≥n Promedio</p>
                            </div>
                        </div>
                    </div>

                    <div class="info-box">
                        <h5>üí∞ Proyecci√≥n de Costos</h5>
                        <ul>
                            <li><strong>Costo actual total/semana:</strong> $24.0M CLP</li>
                            <li><strong>Costo actual mensual:</strong> $96.0M CLP</li>
                            <li><strong>Costo actual anual:</strong> $1,248M CLP</li>
                            <li><strong>Excedente por courier:</strong> ~53 m¬≥/semana (9.8%)</li>
                        </ul>
                    </div>
                </div>

                <!-- Explorador de Datos Tab -->
                <div class="tab-pane fade" id="tabla" role="tabpanel">
                    <h2 class="section-title">Explorador de Datos de Transporte</h2>

                    <!-- Filtros -->
                    <div class="filter-section">
                        <h5>üîç Filtros</h5>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Transportista</label>
                                <select id="filterTransportista" class="form-select">
                                    <option value="">Todos</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Origen</label>
                                <select id="filterOrigen" class="form-select">
                                    <option value="">Todos</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Destino</label>
                                <select id="filterDestino" class="form-select">
                                    <option value="">Todos</option>
                                </select>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">&nbsp;</label>
                                <button id="btnLimpiarFiltros" class="btn btn-secondary w-100">Limpiar Filtros</button>
                            </div>
                        </div>
                    </div>

                    <!-- Estad√≠sticas Filtradas -->
                    <div id="estadisticasFiltradas" class="row mb-4">
                        <div class="col-md-3">
                            <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <h3 id="statEnvios">0</h3>
                                <p>Env√≠os Filtrados</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <h3 id="statCostoTotal">$0</h3>
                                <p>Costo Total</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <h3 id="statVolumen">0</h3>
                                <p>Volumen Total (m¬≥)</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                <h3 id="statPeso">0</h3>
                                <p>Peso Total (kg)</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tabla de Datos -->
                    <div class="table-responsive">
                        <table id="tablaDatos" class="table table-striped table-hover" style="width:100%">
                            <thead class="table-dark">
                                <tr>
                                    <th>Transportista</th>
                                    <th>Origen</th>
                                    <th>Destino</th>
                                    <th>Fecha</th>
                                    <th>Volumen (m¬≥)</th>
                                    <th>Peso (kg)</th>
                                    <th>Importe (CLP)</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Datos globales
        let datosTransporte = [];
        let dataTable;

        // Cargar datos del archivo
        async function cargarDatos() {
            // Mostrar mensaje de carga
            const loadingMsg = document.createElement('div');
            loadingMsg.id = 'loadingMsg';
            loadingMsg.className = 'alert alert-info text-center';
            loadingMsg.style.position = 'fixed';
            loadingMsg.style.top = '50%';
            loadingMsg.style.left = '50%';
            loadingMsg.style.transform = 'translate(-50%, -50%)';
            loadingMsg.style.zIndex = '9999';
            loadingMsg.innerHTML = '<h4>‚è≥ Cargando datos...</h4><p>Por favor espera mientras procesamos la informaci√≥n</p>';
            document.body.appendChild(loadingMsg);

            try {
                console.log('Intentando cargar datos_procesados.json...');
                const response = await fetch('datos_procesados.json');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                datosTransporte = await response.json();
                console.log(`‚úì Datos cargados: ${datosTransporte.length} registros`);

                // Remover mensaje de carga
                document.body.removeChild(loadingMsg);

                inicializarTabla();
                inicializarFiltros();
                inicializarGraficos();
                actualizarEstadisticas();

                // Mostrar mensaje de √©xito
                const successMsg = document.createElement('div');
                successMsg.className = 'alert alert-success';
                successMsg.style.position = 'fixed';
                successMsg.style.top = '20px';
                successMsg.style.right = '20px';
                successMsg.style.zIndex = '9999';
                successMsg.innerHTML = `‚úì ${datosTransporte.length.toLocaleString('es-CL')} registros cargados correctamente`;
                document.body.appendChild(successMsg);

                setTimeout(() => {
                    document.body.removeChild(successMsg);
                }, 3000);

            } catch (error) {
                console.error('Error cargando datos:', error);
                document.body.removeChild(loadingMsg);

                const errorMsg = document.createElement('div');
                errorMsg.className = 'alert alert-danger';
                errorMsg.style.position = 'fixed';
                errorMsg.style.top = '50%';
                errorMsg.style.left = '50%';
                errorMsg.style.transform = 'translate(-50%, -50%)';
                errorMsg.style.zIndex = '9999';
                errorMsg.style.maxWidth = '600px';
                errorMsg.innerHTML = `
                    <h4>‚ùå Error al cargar datos</h4>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <hr>
                    <p><strong>Soluci√≥n:</strong> Aseg√∫rate de que:</p>
                    <ol>
                        <li>El archivo "datos_procesados.json" est√© en el mismo directorio</li>
                        <li>Est√©s ejecutando desde un servidor local (http://localhost:8000)</li>
                        <li>El servidor est√© corriendo correctamente</li>
                    </ol>
                    <p class="mb-0"><em>Revisa la consola del navegador (F12) para m√°s detalles</em></p>
                `;
                document.body.appendChild(errorMsg);
            }
        }

        // Inicializar tabla DataTables
        function inicializarTabla() {
            dataTable = $('#tablaDatos').DataTable({
                data: datosTransporte,
                columns: [
                    { data: 'transportista' },
                    { data: 'origen' },
                    { data: 'destino' },
                    { data: 'fecha' },
                    {
                        data: 'volumen',
                        render: function(data) {
                            return data.toFixed(3);
                        }
                    },
                    {
                        data: 'peso',
                        render: function(data) {
                            return data.toFixed(0);
                        }
                    },
                    {
                        data: 'importe',
                        render: function(data) {
                            return '$' + data.toLocaleString('es-CL');
                        }
                    }
                ],
                pageLength: 25,
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
                },
                order: [[6, 'desc']]
            });
        }

        // Inicializar filtros
        function inicializarFiltros() {
            const transportistas = [...new Set(datosTransporte.map(d => d.transportista))].sort();
            const origenes = [...new Set(datosTransporte.map(d => d.origen))].sort();
            const destinos = [...new Set(datosTransporte.map(d => d.destino))].sort();

            transportistas.forEach(t => {
                $('#filterTransportista').append(`<option value="${t}">${t}</option>`);
            });

            origenes.forEach(o => {
                $('#filterOrigen').append(`<option value="${o}">${o}</option>`);
            });

            destinos.forEach(d => {
                $('#filterDestino').append(`<option value="${d}">${d}</option>`);
            });

            // Event listeners
            $('#filterTransportista, #filterOrigen, #filterDestino').on('change', aplicarFiltros);
            $('#btnLimpiarFiltros').on('click', limpiarFiltros);
        }

        // Aplicar filtros
        function aplicarFiltros() {
            const transportista = $('#filterTransportista').val();
            const origen = $('#filterOrigen').val();
            const destino = $('#filterDestino').val();

            dataTable
                .column(0).search(transportista)
                .column(1).search(origen)
                .column(2).search(destino)
                .draw();

            actualizarEstadisticas();
        }

        // Limpiar filtros
        function limpiarFiltros() {
            $('#filterTransportista, #filterOrigen, #filterDestino').val('');
            dataTable.search('').columns().search('').draw();
            actualizarEstadisticas();
        }

        // Actualizar estad√≠sticas
        function actualizarEstadisticas() {
            const datosFiltrados = dataTable.rows({ search: 'applied' }).data().toArray();

            const totalEnvios = datosFiltrados.length;
            const totalCosto = datosFiltrados.reduce((sum, d) => sum + d.importe, 0);
            const totalVolumen = datosFiltrados.reduce((sum, d) => sum + d.volumen, 0);
            const totalPeso = datosFiltrados.reduce((sum, d) => sum + d.peso, 0);

            $('#statEnvios').text(totalEnvios.toLocaleString('es-CL'));
            $('#statCostoTotal').text('$' + Math.round(totalCosto).toLocaleString('es-CL'));
            $('#statVolumen').text(totalVolumen.toFixed(1));
            $('#statPeso').text(Math.round(totalPeso).toLocaleString('es-CL'));
        }

        // Inicializar gr√°ficos
        function inicializarGraficos() {
            // Gr√°fico de Pareto
            const ctxPareto = document.getElementById('paretoChart').getContext('2d');
            new Chart(ctxPareto, {
                type: 'bar',
                data: {
                    labels: ['Top 17 Rutas', 'Otras Rutas'],
                    datasets: [{
                        label: 'Costo',
                        data: [80, 20],
                        backgroundColor: ['#667eea', '#e0e0e0']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Principio 80/20 - Concentraci√≥n de Costos'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '% del Costo Total'
                            }
                        }
                    }
                }
            });

            // Gr√°fico de costos por transportista
            const ctxCostos = document.getElementById('costosChart').getContext('2d');
            new Chart(ctxCostos, {
                type: 'doughnut',
                data: {
                    labels: ['PDQ', 'SAMEX', 'TVP'],
                    datasets: [{
                        data: [130.4, 173.0, 117.7],
                        backgroundColor: ['#667eea', '#43e97b', '#f5576c']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Distribuci√≥n de Costos por Transportista (Millones CLP)'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Gr√°fico por d√≠a de semana
            const ctxDias = document.getElementById('diasChart').getContext('2d');
            new Chart(ctxDias, {
                type: 'bar',
                data: {
                    labels: ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'],
                    datasets: [{
                        label: 'Env√≠os',
                        data: [2008, 2237, 2036, 2129, 1702, 24],
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Distribuci√≥n de Env√≠os por D√≠a de la Semana'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'N√∫mero de Env√≠os'
                            }
                        }
                    }
                }
            });

            // Gr√°fico de rutas principales
            const ctxRutas = document.getElementById('rutasChart').getContext('2d');
            new Chart(ctxRutas, {
                type: 'horizontalBar',
                data: {
                    labels: [
                        'Antofagasta',
                        'Iquique',
                        'Puerto Montt',
                        'Temuco',
                        'Calama',
                        'Copiap√≥',
                        'La Serena',
                        'Concepci√≥n',
                        'Valdivia',
                        'Talca'
                    ],
                    datasets: [{
                        label: 'Costo (Millones CLP)',
                        data: [45.5, 36.5, 22.3, 21.9, 20.9, 19.8, 18.9, 17.4, 15.8, 15.7],
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Top 10 Rutas M√°s Costosas desde Santiago'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Costo Total (Millones CLP)'
                            }
                        }
                    }
                }
            });
        }

        // Inicializar cuando el DOM est√© listo
        $(document).ready(function() {
            cargarDatos();
        });
    </script>
</body>
</html>